<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Hospital AMR Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-accent: #007bff; /* Vibrant Blue - Bootstrap Primary */
            --primary-accent-rgb: 0, 123, 255;
            --primary-light: #e6f2ff; /* Light blue for backgrounds/hovers */
            --secondary-accent: #6c757d; /* Neutral Gray - Bootstrap Secondary */
            --secondary-accent-rgb: 108, 117, 125;
            
            --positive-green: #28a745; /* Bootstrap Success Green */
            --positive-green-rgb: 40, 167, 69;
            --negative-red: #dc3545; /* Bootstrap Danger Red */
            --negative-red-rgb: 220, 53, 69;
            --warning-orange: #ffc107; /* Bootstrap Warning Yellow/Orange */
            --warning-orange-rgb: 255, 193, 7;
            --info-teal: #17a2b8; /* Bootstrap Info Teal */
            --info-teal-rgb: 23, 162, 184;

            --bg-body: #f4f7fc; /* Very light gray, almost off-white */
            --bg-card: #ffffff;
            --text-dark: #343a40; /* Bootstrap default dark text */
            --text-medium: #6c757d; /* Bootstrap default secondary text */
            --text-light: #adb5bd;
            --border-color: #dee2e6; /* Bootstrap default border color */
            --border-soft: #e9ecef;
            --white: #fff;

            --bs-body-font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }
        
        /* Import Inter font (optional, but modern) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            background-color: var(--bg-body);
            font-family: var(--bs-body-font-family);
            color: var(--text-dark);
            font-weight: 400;
        }
        
        /* Sidebar Styling */
        .sidebar {
            background-color: var(--bg-card);
            border-right: 1px solid var(--border-soft);
        }
        @media (min-width: 992px) {
            .sidebar.offcanvas-lg {
                position: sticky; top: 0; height: 100vh; overflow-y: auto;
                box-shadow: 2px 0 10px rgba(0,0,0,0.03);
                border-right: none;
            }
        }
        .sidebar-header {
            color: var(--primary-accent);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .filter-title {
            font-weight: 600; margin-bottom: 0.75rem; color: var(--text-medium); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .filter-section { margin-bottom: 1.25rem; }
        .form-check-label, .form-select, .form-control { font-size: 0.9rem; }
        .sidebar .btn-primary { /* Apply Filters button */
            background-color: var(--primary-accent); border-color: var(--primary-accent); font-weight: 500;
        }
        .sidebar .btn-primary:hover { background-color: #0069d9; border-color: #0062cc; }

        /* Main Dashboard Header Card */
        .dashboard-header-card {
            background-color: var(--bg-card);
            color: var(--text-dark);
            padding: 1.5rem; margin-bottom: 2rem; border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-left: 5px solid var(--primary-accent);
        }
        .dashboard-header-card h1 { font-size: 1.75rem; font-weight: 600; color: var(--primary-accent); }
        .dashboard-header-card p { font-size: 0.95rem; color: var(--text-medium); }
        @media (min-width: 768px) { .dashboard-header-card h1 { font-size: 2rem; } }


        /* Cards */
        .card {
            border: none; border-radius: 0.75rem; /* Slightly more rounded */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); /* Softer, more diffused shadow */
            margin-bottom: 1.5rem; background-color: var(--bg-card);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.07); }
        .card-header {
            background-color: transparent; /* No background for header */
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-soft);
            font-weight: 600; font-size: 1rem; padding: 1rem 1.25rem;
        }
        
        /* Metric Cards */
        .metric-card { text-align: left; padding: 1.25rem; }
        .metric-card .metric-content { display: flex; align-items: center; }
        .metric-card .metric-icon-wrapper {
            font-size: 1.5rem; margin-right: 1rem; color: var(--primary-accent);
            background-color: var(--primary-light); width: 48px; height: 48px;
            border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;
        }
        .metric-value { font-size: 1.75rem; font-weight: 700; color: var(--text-dark); margin-bottom: 0.1rem; }
        .metric-title { color: var(--text-medium); font-weight: 500; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.3px; }
        .metric-subtext { font-size: 0.8rem; color: var(--text-light); }

        .trend-positive { color: var(--negative-red); font-weight: 500; } /* Increasing resistance = bad */
        .trend-negative { color: var(--positive-green); font-weight: 500; } /* Decreasing resistance = good */
        
        /* Navigation Tabs */
        .nav-pills .nav-link {
            color: var(--text-medium); font-weight: 500; padding: 0.6rem 1.25rem;
            border-radius: 0.5rem; margin-right: 0.25rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .nav-pills .nav-link.active, .nav-pills .show > .nav-link {
            background-color: var(--primary-accent); color: var(--white);
        }
        .nav-pills .nav-link:not(.active):hover { background-color: var(--primary-light); color: var(--primary-accent); }

        /* Chart Container */
        .chart-container { position: relative; height: 320px; margin-bottom: 1rem; }
        
        /* Tables */
        .table { border-collapse: separate; border-spacing: 0; } /* For rounded corners on table */
        .table thead th {
            background-color: var(--bg-body); /* Lighter header */
            color: var(--text-medium); font-weight: 600; font-size: 0.85rem;
            text-transform: uppercase; letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color); border-top: none;
        }
        .table thead th .btn-link { font-size: 0.85rem; color: var(--text-medium); }
        .table thead th .btn-link:hover, .table thead th .btn-link:focus { text-decoration: none; color: var(--primary-accent); }
        .table thead th .fas.fa-sort { margin-left: 5px; opacity: 0.6; }

        .table tbody tr td {
            vertical-align: middle; font-size: 0.9rem; color: var(--text-dark);
            border-top: 1px solid var(--border-soft);
        }
        .table-hover tbody tr:hover { background-color: var(--primary-light); }
        .data-table-wrapper { border-radius: 0.75rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        
        /* Badges */
        .badge { font-weight: 500; padding: 0.4em 0.7em; font-size: 0.8rem; }
        .badge-increasing { background-color: rgba(var(--negative-red-rgb), 0.1); color: var(--negative-red); }
        .badge-decreasing { background-color: rgba(var(--positive-green-rgb), 0.1); color: var(--positive-green); }
        .badge-stable { background-color: rgba(var(--secondary-accent-rgb), 0.1); color: var(--secondary-accent); }
        
        /* Main Content Area */
        .main-content-wrapper { padding: 1.5rem; }
        @media (max-width: 991.98px) { .main-content-wrapper { padding-left: 1.5rem; } }

        /* Footer */
        .dashboard-footer { padding: 1.5rem 0 1rem 0; border-top: 1px solid var(--border-soft); font-size: 0.85rem; color: var(--text-medium); }

        /* Offcanvas specific tweaks */
        .offcanvas-lg { max-width: 280px; }
        .offcanvas-header { border-bottom: 1px solid var(--border-soft); }
        .btn-outline-primary { border-color: var(--primary-accent); color: var(--primary-accent); }
        .btn-outline-primary:hover { background-color: var(--primary-accent); color: var(--white); }

        .alert { border-left-width: 4px; border-radius: 0.5rem; }
        .alert-danger { border-left-color: var(--negative-red); background-color: rgba(var(--negative-red-rgb), 0.05); color: var(--negative-red); }
        .alert-warning { border-left-color: var(--warning-orange); background-color: rgba(var(--warning-orange-rgb), 0.05); color: #b98000; }
        .alert-warning .alert-heading { color: #b98000; }
        .alert-info { border-left-color: var(--info-teal); background-color: rgba(var(--info-teal-rgb), 0.05); color: var(--info-teal); }
        .alert-info .alert-heading { color: var(--info-teal); }
        .alert-heading { font-weight: 600; }

        .list-group-item { border-color: var(--border-soft); }
        .list-group-item-action:hover { background-color: var(--primary-light); }

        .search-bar-wrapper { max-width: 300px; }

        .heatmap-low { background-color: rgba(var(--positive-green-rgb), 0.2); color: var(--positive-green); padding: 0.2em 0.4em; border-radius: 0.25rem; font-weight: 500;}
        .heatmap-medium { background-color: rgba(var(--warning-orange-rgb), 0.2); color: var(--warning-orange); padding: 0.2em 0.4em; border-radius: 0.25rem; font-weight: 500;}
        .heatmap-high { background-color: rgba(var(--negative-red-rgb), 0.2); color: var(--negative-red); padding: 0.2em 0.4em; border-radius: 0.25rem; font-weight: 500;}
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row flex-nowrap">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-auto col-lg-2 sidebar offcanvas-lg offcanvas-start p-0" tabindex="-1" aria-labelledby="sidebarLabel">
                <div class="offcanvas-header d-lg-none p-3">
                   <h5 class="offcanvas-title" id="sidebarLabel"><i class="fas fa-filter me-2"></i>Filters</h5>
                   <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebar" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body d-flex flex-column p-3">
                    <h4 class="sidebar-header d-none d-lg-block">
                        <i class="fas fa-sliders-h me-2"></i>Filters
                    </h4>
                    
                    <div class="filter-section">
                        <div class="filter-title">Time Period</div>
                        <select class="form-select" id="timePeriod"><option value="6">Last 6 Months</option><option value="12" selected>Last 12 Months</option><option value="24">Last 24 Months</option></select>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-title">Wards</div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="wardICU" checked><label class="form-check-label" for="wardICU">ICU</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="wardMedical" checked><label class="form-check-label" for="wardMedical">Medical</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="wardSurgical" checked><label class="form-check-label" for="wardSurgical">Surgical</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="wardPediatrics" checked><label class="form-check-label" for="wardPediatrics">Pediatrics</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="wardOncology" checked><label class="form-check-label" for="wardOncology">Oncology</label></div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="filter-title">Pathogens</div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="pathogenEColi" checked><label class="form-check-label" for="pathogenEColi">E. coli</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="pathogenKPneumoniae" checked><label class="form-check-label" for="pathogenKPneumoniae">K. pneumoniae</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="pathogenSAureus" checked><label class="form-check-label" for="pathogenSAureus">S. aureus</label></div>
                         <div class="form-check"><input class="form-check-input" type="checkbox" id="pathogenPAeruginosa" checked><label class="form-check-label" for="pathogenPAeruginosa">P. aeruginosa</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" id="pathogenEnterococcus" checked><label class="form-check-label" for="pathogenEnterococcus">Enterococcus</label></div>
                    </div>
                     <button class="btn btn-primary w-100 mt-auto" id="applyFilters"><i class="fas fa-check-circle me-2"></i>Apply Filters</button>
                </div>
            </nav>
            
            <!-- Main Content Wrapper -->
            <main class="col ps-md-2 pt-2 main-content-wrapper">
                <div class="dashboard-header-card">
                    <div class="row align-items-center gy-2">
                        <div class="col-md">
                            <h1><i class="fas fa-shield-alt me-2"></i>AMR Dashboard</h1>
                            <p class="d-none d-sm-block mb-0">Antimicrobial Resistance Surveillance & Stewardship Insights</p>
                        </div>
                        <div class="col-md-auto">
                            <div class="d-flex flex-wrap align-items-center justify-content-md-end">
                                <div class="search-bar-wrapper me-2 mb-2 mb-md-0">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-search"></i></span>
                                        <input type="search" class="form-control border-start-0" placeholder="Search dashboard...">
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary d-lg-none me-2 mb-2 mb-md-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar">
                                    <i class="fas fa-filter"></i> <span class="d-none d-sm-inline">Filters</span>
                                </button>
                                <span class="badge bg-light text-success fs-6 me-md-2 mb-2 mb-md-0"><i class="fas fa-circle me-1 fa-fade" style="font-size:0.7em;"></i>Live</span>
                                <div class="small text-light d-none d-md-block">Updated: <span id="lastUpdated">Now</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Key Metrics -->
                <div class="row">
                    <div class="col-sm-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                            <div class="metric-content">
                                <div class="metric-icon-wrapper"><i class="fas fa-vials"></i></div>
                                <div>
                                    <div class="metric-title">Total Tests</div>
                                    <div class="metric-value">4,287</div>
                                    <div class="metric-subtext text-success">+12% <span class="d-none d-lg-inline">vs last period</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                            <div class="metric-content">
                                <div class="metric-icon-wrapper" style="color: var(--warning-orange); background-color: rgba(var(--warning-orange-rgb), 0.1);"><i class="fas fa-biohazard"></i></div>
                                <div>
                                    <div class="metric-title">Avg Resistance Rate</div>
                                    <div class="metric-value">34.5%</div>
                                    <div class="metric-subtext trend-negative">-2.1% <span class="d-none d-lg-inline">vs last period</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                           <div class="metric-content">
                                <div class="metric-icon-wrapper" style="color: var(--negative-red); background-color: rgba(var(--negative-red-rgb), 0.1);"><i class="fas fa-arrow-trend-up"></i></div>
                                <div>
                                    <div class="metric-title">Increasing Trends</div>
                                    <div class="metric-value trend-positive">8</div>
                                    <div class="metric-subtext">Critical: 3</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                            <div class="metric-content">
                                <div class="metric-icon-wrapper" style="color: var(--positive-green); background-color: rgba(var(--positive-green-rgb), 0.1);"><i class="fas fa-arrow-trend-down"></i></div>
                                <div>
                                    <div class="metric-title">Decreasing Trends</div>
                                    <div class="metric-value trend-negative">5</div>
                                    <div class="metric-subtext text-success">+3 <span class="d-none d-lg-inline">vs last period</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Metrics Row -->
                <div class="row">
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                             <div class="metric-title text-center mb-2 border-bottom pb-2">Lab Volumes (Last 30d)</div>
                            <div class="d-flex justify-content-around">
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">CSF Samples</div>
                                    <div class="metric-value fs-4">128</div>
                                </div>
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">Blood Cultures</div>
                                    <div class="metric-value fs-4">756</div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                            <div class="metric-title text-center mb-2 border-bottom pb-2">Positive Cultures (Last 30d)</div>
                            <div class="d-flex justify-content-around">
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">CSF Positive</div>
                                    <div class="metric-value fs-4">15 <small class="fs-6 text-muted">(11.7%)</small></div>
                                </div>
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">Blood Positive</div>
                                    <div class="metric-value fs-4">210 <small class="fs-6 text-muted">(27.8%)</small></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                            <div class="metric-title text-center mb-2 border-bottom pb-2">Key AMR Patterns (Last 30d)</div>
                             <div class="d-flex justify-content-around">
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">ESBL Detected</div>
                                    <div class="metric-value fs-4">45</div>
                                </div>
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">CRE Detected</div>
                                    <div class="metric-value fs-4">12</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card metric-card h-100">
                            <div class="metric-title text-center mb-2 border-bottom pb-2">Quick Snapshot</div>
                            <div class="d-flex justify-content-around">
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">Top Pathogen</div>
                                    <div class="metric-value fs-5" style="line-height:1.2;">E. coli</div>
                                </div>
                                <div class="text-center">
                                    <div class="metric-subtext mb-1">Top Ward (Isolates)</div>
                                    <div class="metric-value fs-5" style="line-height:1.2;">ICU</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <ul class="nav nav-pills mb-4" id="dashboardTabs" role="tablist">
                    <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#trends"><i class="fas fa-chart-line me-2"></i>Trends & Alerts</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#pathogens"><i class="fas fa-bacterium me-2"></i>Pathogens</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#wards"><i class="fas fa-hospital-user me-2"></i>Wards</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#stewardship"><i class="fas fa-notes-medical me-2"></i>Stewardship</button></li>
                </ul>
                
                <div class="tab-content" id="dashboardTabsContent">
                    <div class="tab-pane fade show active" id="trends" role="tabpanel">
                        <div class="row">
                            <div class="col-12 col-xl-7 mb-4"><div class="card h-100"><div class="card-header"><i class="fas fa-chart-line me-2"></i>Resistance Trends Over Time (Pathogen-Antibiotic)</div><div class="card-body pt-3"><div class="chart-container" style="height: 340px;"><canvas id="trendChart"></canvas></div></div></div></div>
                            <div class="col-12 col-xl-5 mb-4"><div class="card h-100"><div class="card-header"><i class="fas fa-tachometer-alt-fast me-2"></i>Current Resistance Snapshot (Key Pathogens)</div><div class="card-body pt-3"><div class="chart-container" style="height: 340px;"><canvas id="currentResistanceChart"></canvas></div></div></div></div>
                        </div>
                        <div class="row">
                            <div class="col-12 mb-4">
                                <div class="card h-100">
                                    <div class="card-header"><i class="fas fa-project-diagram me-2"></i>AMR Pattern Trends (ESBL, CRE - Overall)</div>
                                    <div class="card-body pt-3">
                                        <div class="chart-container" style="height: 300px;"><canvas id="amrPatternTrendChart"></canvas></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card"><div class="card-header"><i class="fas fa-exclamation-triangle me-2"></i>Recent Spike Alerts (Last 30 Days)</div><div class="card-body p-0"><div class="table-responsive data-table-wrapper"><table class="table table-hover mb-0">
                            <thead><tr>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Pathogen <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Antibiotic/Pattern <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Ward <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Rate <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Trend (30d) <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Tests (30d) <i class="fas fa-sort"></i></button></th>
                                <th>Action</th>
                            </tr></thead>
                            <tbody>
                                <tr><td>K. pneumoniae</td><td>Meropenem</td><td>ICU</td><td>78%</td><td><span class="badge badge-increasing">Sharp Increase</span></td><td>45</td><td><button class="btn btn-sm btn-outline-danger py-1 px-2">Review</button></td></tr>
                                <tr><td>P. aeruginosa</td><td>Pip-Tazo</td><td>Oncology</td><td>65%</td><td><span class="badge badge-increasing">Increase</span></td><td>32</td><td><button class="btn btn-sm btn-outline-danger py-1 px-2">Review</button></td></tr>
                                <tr><td>E. coli</td><td>ESBL Profile</td><td>Medical</td><td>58%</td><td><span class="badge badge-stable">Stable High</span></td><td>87</td><td><button class="btn btn-sm btn-outline-warning py-1 px-2">Monitor</button></td></tr>
                                <tr><td>A. baumannii</td><td>CRE Profile</td><td>ICU</td><td>25%</td><td><span class="badge badge-increasing">New Cluster</span></td><td>12</td><td><button class="btn btn-sm btn-outline-danger py-1 px-2">Investigate</button></td></tr>
                                <tr><td>S. aureus</td><td>Vancomycin</td><td>Surgical</td><td>12%</td><td><span class="badge badge-decreasing">Decreasing</span></td><td>63</td><td><button class="btn btn-sm btn-outline-success py-1 px-2">Track</button></td></tr>
                            </tbody>
                        </table></div></div></div>
                    </div>
                    
                    <div class="tab-pane fade" id="pathogens" role="tabpanel">
                         <div class="row">
                            <div class="col-12 col-lg-4 mb-4">
                                <div class="card"><div class="card-header"><i class="fas fa-microscope me-2"></i>Select Pathogen</div>
                                    <div class="card-body"><select class="form-select" id="pathogenSelect">
                                        <option value="E. coli">E. coli</option><option value="K. pneumoniae">K. pneumoniae</option><option value="S. aureus">S. aureus</option><option value="P. aeruginosa">P. aeruginosa</option><option value="Enterococcus spp.">Enterococcus spp.</option>
                                    </select></div>
                                </div>
                                <div class="card mt-4"><div class="card-header"><i class="fas fa-file-medical-alt me-2"></i>Pathogen Profile</div>
                                    <div class="card-body">
                                        <h5 id="selectedPathogenName" class="mb-1" style="color:var(--primary-accent);">E. coli</h5>
                                        <p id="pathogenDescription" class="small text-medium mb-3">Gram-negative bacterium commonly found in the lower intestine.</p>
                                        <h6>Resistance Snapshot:</h6>
                                        <ul class="list-unstyled small">
                                            <li class="d-flex justify-content-between py-1 border-bottom border-soft"><span>Highest:</span><strong id="highestResistance">Ciprofloxacin (62%)</strong></li>
                                            <li class="d-flex justify-content-between py-1 border-bottom border-soft"><span>Lowest:</span><strong id="lowestResistance">Meropenem (8%)</strong></li>
                                            <li class="d-flex justify-content-between py-1"><span>Top Ward:</span><strong id="commonWard">Medical (42%)</strong></li>
                                        </ul>
                                    </div>
                                </div>
                                 <div class="card mt-4">
                                    <div class="card-header"><i class="fas fa-list-ol me-2"></i>Top 10 Isolated Pathogens (Last 30d)</div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive data-table-wrapper">
                                            <table class="table table-sm table-hover mb-0">
                                                <thead><tr>
                                                    <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">#</button></th>
                                                    <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">Pathogen <i class="fas fa-sort"></i></button></th>
                                                    <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">Count <i class="fas fa-sort"></i></button></th>
                                                </tr></thead>
                                                <tbody>
                                                    <tr><td>1</td><td>E. coli</td><td>185</td></tr>
                                                    <tr><td>2</td><td>K. pneumoniae</td><td>120</td></tr>
                                                    <tr><td>3</td><td>S. aureus</td><td>98</td></tr>
                                                    <tr><td>4</td><td>P. aeruginosa</td><td>75</td></tr>
                                                    <tr><td>5</td><td>Enterococcus spp.</td><td>62</td></tr>
                                                    <tr><td>6</td><td>A. baumannii</td><td>45</td></tr>
                                                    <tr><td>7</td><td>S. epidermidis</td><td>33</td></tr>
                                                    <tr><td>8</td><td>C. albicans</td><td>29</td></tr>
                                                    <tr><td>9</td><td>Enterobacter spp.</td><td>25</td></tr>
                                                    <tr><td>10</td><td>S. pyogenes</td><td>18</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-8">
                                <div class="card mb-4"><div class="card-header"><i class="fas fa-tablets me-2"></i>Resistance by Antibiotic</div><div class="card-body pt-3"><div class="chart-container"><canvas id="pathogenResistanceChart"></canvas></div></div></div>
                                <div class="card"><div class="card-header"><i class="fas fa-wave-square me-2"></i>Historical Trends for Selected Pathogen</div><div class="card-body pt-3"><div class="chart-container"><canvas id="pathogenTrendChart"></canvas></div></div></div>
                            </div>
                        </div>
                    </div>
                     <div class="tab-pane fade" id="wards" role="tabpanel">
                        <div class="row">
                            <div class="col-12 col-xl-6 mb-4"><div class="card h-100"><div class="card-header"><i class="fas fa-procedures me-2"></i>Avg. Resistance by Ward</div><div class="card-body pt-3"><div class="chart-container" style="height:350px;"><canvas id="wardResistanceChart"></canvas></div></div></div></div>
                            <div class="col-12 col-xl-6 mb-4"><div class="card h-100"><div class="card-header"><i class="fas fa-chart-pie me-2"></i>Ward Test Distribution</div><div class="card-body pt-3"><div class="chart-container" style="height:350px;"><canvas id="wardDistributionChart"></canvas></div></div></div></div>
                        </div>
                        <div class="card mt-2 mb-4">
                            <div class="card-header"><i class="fas fa-th me-2"></i>Ward Isolate Heatmap (Pathogen %, Last 30d)</div>
                            <div class="card-body p-0">
                                <div class="table-responsive data-table-wrapper">
                                    <table class="table table-bordered table-sm text-center mb-0">
                                        <thead>
                                            <tr>
                                                <th class="text-start"><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">Ward <i class="fas fa-sort"></i></button></th>
                                                <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">E. coli <i class="fas fa-sort"></i></button></th>
                                                <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">K. pneu <i class="fas fa-sort"></i></button></th>
                                                <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">S. aur <i class="fas fa-sort"></i></button></th>
                                                <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">P. aeru <i class="fas fa-sort"></i></button></th>
                                                <th><button class="btn btn-link btn-xs p-0 text-decoration-none text-muted">Total Isolates <i class="fas fa-sort"></i></button></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td class="text-start">ICU</td><td><span class="heatmap-medium">22%</span></td><td><span class="heatmap-high">35%</span></td><td><span class="heatmap-low">8%</span></td><td><span class="heatmap-medium">18%</span></td><td>150</td></tr>
                                            <tr><td class="text-start">Medical</td><td><span class="heatmap-high">40%</span></td><td><span class="heatmap-medium">15%</span></td><td><span class="heatmap-low">5%</span></td><td><span class="heatmap-low">7%</span></td><td>120</td></tr>
                                            <tr><td class="text-start">Surgical</td><td><span class="heatmap-low">15%</span></td><td><span class="heatmap-low">10%</span></td><td><span class="heatmap-high">30%</span></td><td><span class="heatmap-medium">12%</span></td><td>110</td></tr>
                                            <tr><td class="text-start">Pediatrics</td><td><span class="heatmap-medium">25%</span></td><td><span class="heatmap-low">8%</span></td><td><span class="heatmap-low">10%</span></td><td><span class="heatmap-medium">20%</span></td><td>80</td></tr>
                                            <tr><td class="text-start">Oncology</td><td><span class="heatmap-medium">20%</span></td><td><span class="heatmap-medium">25%</span></td><td><span class="heatmap-low">6%</span></td><td><span class="heatmap-high">28%</span></td><td>95</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="card mt-2"><div class="card-header"><i class="fas fa-th-list me-2"></i>Ward-Specific Data (Overall)</div><div class="card-body p-0"><div class="table-responsive data-table-wrapper"><table class="table table-hover mb-0" id="wardDataTable">
                            <thead><tr>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Ward <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Tests <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Avg Resist. <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Top Pathogen <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Top Antibiotic (Resist) <i class="fas fa-sort"></i></button></th>
                                <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Trend <i class="fas fa-sort"></i></button></th>
                            </tr></thead>
                            <tbody>
                                <tr><td>ICU</td><td>1,245</td><td>48%</td><td>K. pneumoniae</td><td>Meropenem</td><td><span class="badge badge-increasing">Increasing</span></td></tr>
                                <tr><td>Medical</td><td>987</td><td>32%</td><td>E. coli</td><td>Ciprofloxacin</td><td><span class="badge badge-stable">Stable</span></td></tr>
                                <tr><td>Surgical</td><td>856</td><td>28%</td><td>S. aureus</td><td>Vancomycin</td><td><span class="badge badge-decreasing">Decreasing</span></td></tr>
                                <tr><td>Pediatrics</td><td>723</td><td>25%</td><td>P. aeruginosa</td><td>Ceftazidime</td><td><span class="badge badge-stable">Stable</span></td></tr>
                                <tr><td>Oncology</td><td>476</td><td>41%</td><td>P. aeruginosa</td><td>Pip-Tazo</td><td><span class="badge badge-increasing">Increasing</span></td></tr>
                            </tbody>
                        </table></div></div></div>
                    </div>
                     <div class="tab-pane fade" id="stewardship" role="tabpanel">
                        <div class="row">
                            <div class="col-12 col-lg-6 mb-4">
                                <div class="card"><div class="card-header"><i class="fas fa-flag me-2"></i>Top Resistance Concerns</div><div class="card-body p-0"><div class="table-responsive data-table-wrapper"><table class="table table-hover mb-0">
                                    <thead><tr>
                                        <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Combination <i class="fas fa-sort"></i></button></th>
                                        <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Rate <i class="fas fa-sort"></i></button></th>
                                        <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Trend <i class="fas fa-sort"></i></button></th>
                                        <th><button class="btn btn-link btn-sm p-0 text-decoration-none text-muted">Priority <i class="fas fa-sort"></i></button></th>
                                    </tr></thead>
                                    <tbody>
                                        <tr><td>K. pneumo + Mero</td><td>78%</td><td><span class="badge badge-increasing">Increasing</span></td><td><span class="badge bg-danger text-white">Critical</span></td></tr>
                                        <tr><td>P. aeru + Pip-Tazo</td><td>65%</td><td><span class="badge badge-increasing">Increasing</span></td><td><span class="badge bg-danger text-white">Critical</span></td></tr>
                                        <tr><td>E. coli + Cipro</td><td>58%</td><td><span class="badge badge-stable">Stable</span></td><td><span class="badge bg-warning text-dark">High</span></td></tr>
                                        <tr><td>Entero spp. + Vanco</td><td>22%</td><td><span class="badge badge-increasing">Increasing</span></td><td><span class="badge bg-warning text-dark">High</span></td></tr>
                                        <tr><td>S. aureus + Ceftria</td><td>45%</td><td><span class="badge badge-decreasing">Decreasing</span></td><td><span class="badge bg-info text-white">Medium</span></td></tr>
                                    </tbody>
                                </table></div></div></div>
                                <div class="card mt-4"><div class="card-header"><i class="fas fa-award me-2"></i>Stewardship Successes</div><div class="card-body p-2"><div class="list-group list-group-flush">
                                    <a href="#" class="list-group-item list-group-item-action"><div class="d-flex w-100 justify-content-between"><h6 class="mb-1">S. aureus + Vancomycin</h6><small class="text-success fw-bold">12% (-8%)</small></div><p class="mb-1 small">Resistance decreased after protocol changes.</p><small class="text-muted">Implemented: Jan 2023</small></a>
                                    <a href="#" class="list-group-item list-group-item-action"><div class="d-flex w-100 justify-content-between"><h6 class="mb-1">E. coli + Meropenem</h6><small class="text-success fw-bold">9% (Stable)</small></div><p class="mb-1 small">Low resistance maintained with restricted use.</p><small class="text-muted">Implemented: Ongoing</small></a>
                                </div></div></div>
                            </div>
                            <div class="col-12 col-lg-6 mb-4">
                                <div class="card"><div class="card-header"><i class="fas fa-bullseye me-2"></i>Recommended Actions</div><div class="card-body">
                                    <div class="alert alert-danger"><h6 class="alert-heading"><i class="fas fa-engine-warning me-2"></i>Immediate Actions</h6><ul class="mb-0 small ps-3"><li>Review meropenem use in ICU for K. pneumoniae.</li><li>Consider alternatives for P. aeruginosa in Oncology.</li></ul></div>
                                    <div class="alert alert-warning mt-3"><h6 class="alert-heading"><i class="fas fa-ballot-check me-2"></i>Medium-Term</h6><ul class="mb-0 small ps-3"><li>Develop guidelines for Enterococcus spp.</li><li>Educate staff on ciprofloxacin resistance in E. coli.</li></ul></div>
                                    <div class="alert alert-info mt-3"><h6 class="alert-heading"><i class="fas fa-analytics me-2"></i>Monitoring Priorities</h6><ul class="mb-0 small ps-3"><li>Track S. aureus vancomycin resistance.</li><li>Assess impact of meropenem restrictions.</li></ul></div>
                                </div></div>
                                <div class="card mt-4"><div class="card-header"><i class="fas fa-chart-network me-2"></i>Intervention Impact</div><div class="card-body pt-3"><div class="chart-container" style="height: 270px;"><canvas id="interventionChart"></canvas></div></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <footer class="dashboard-footer mt-4">
                    <div class="row">
                        <div class="col-md-6"><p><i class="fas fa-info-circle me-1"></i> Data updated hourly. Resistance rate = (Resistant Isolates / Tested Isolates) × 100</p></div>
                        <div class="col-md-6 text-md-end"><p>AMR Dashboard v3.1 © 2023 Hospital Infection Control</p></div>
                    </div>
                </footer>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const CHART_COLORS = {
            primary: 'rgba(0, 123, 255, 1)', // var(--primary-accent)
            primaryLight: 'rgba(0, 123, 255, 0.2)',
            red: 'rgba(220, 53, 69, 1)', // var(--negative-red)
            redLight: 'rgba(220, 53, 69, 0.2)',
            green: 'rgba(40, 167, 69, 1)', // var(--positive-green)
            greenLight: 'rgba(40, 167, 69, 0.2)',
            orange: 'rgba(255, 193, 7, 1)', // var(--warning-orange)
            orangeLight: 'rgba(255, 193, 7, 0.2)',
            teal: 'rgba(23, 162, 184, 1)', // var(--info-teal)
            tealLight: 'rgba(23, 162, 184, 0.2)',
            purple: 'rgba(111, 66, 193, 1)',
            purpleLight: 'rgba(111, 66, 193, 0.2)',
            gray: 'rgba(108, 117, 125, 1)', // var(--secondary-accent)
            grayLight: 'rgba(108, 117, 125, 0.2)',
            textDark: '#343a40',
            gridColor: '#e9ecef',
            white: '#ffffff'
        };

        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.font.weight = '400';
        Chart.defaults.color = CHART_COLORS.textDark;
        Chart.defaults.borderColor = CHART_COLORS.gridColor;
        Chart.defaults.plugins.title.font.size = 16;
        Chart.defaults.plugins.title.font.weight = '600';
        Chart.defaults.plugins.title.color = CHART_COLORS.textDark;
        Chart.defaults.plugins.title.padding = { top: 5, bottom: 20 };
        Chart.defaults.plugins.legend.labels.boxWidth = 12;
        Chart.defaults.plugins.legend.labels.padding = 15;
        Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0,0,0,0.75)';
        Chart.defaults.plugins.tooltip.titleFont = { weight: '600' };
        Chart.defaults.plugins.tooltip.bodyFont = { weight: '400' };
        Chart.defaults.plugins.tooltip.padding = 10;
        Chart.defaults.plugins.tooltip.cornerRadius = 4;


        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit'});
            
            const commonChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { title: { display: false }, legend: { position: 'bottom' } },
                scales: { y: { beginAtZero: true, max: 100, grid: { drawBorder: false } }, x: { grid: { display: false } } }
            };
            const commonBarOptions = {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: { title: { display: false }, legend: { display: false } },
                scales: { x: { beginAtZero: true, max: 100, grid: { drawBorder: false } }, y: { grid: { display: false } } }
            };
            
            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
                    datasets: [
                        { label: 'E. coli - Cipro', data: [52,54,56,55,57,58,59,60,59,58,57,58], borderColor: CHART_COLORS.red, backgroundColor: CHART_COLORS.redLight, tension:0.4, fill:true, pointRadius:3, pointHoverRadius:5, borderWidth: 1.5 },
                        { label: 'K. pneumo - Mero', data: [65,67,70,72,73,75,76,77,78,77,76,78], borderColor: CHART_COLORS.orange, backgroundColor: CHART_COLORS.orangeLight, tension:0.4, fill:true, pointRadius:3, pointHoverRadius:5, borderWidth: 1.5 },
                        { label: 'S. aureus - Vanco', data: [18,17,16,15,14,13,12,13,12,12,11,12], borderColor: CHART_COLORS.green, backgroundColor: CHART_COLORS.greenLight, tension:0.4, fill:true, pointRadius:3, pointHoverRadius:5, borderWidth: 1.5 }
                    ]
                },
                options: commonChartOptions
            });
            
            new Chart(document.getElementById('currentResistanceChart'), {
                type: 'bar',
                data: {
                    labels: ['E. coli', 'K. pneumo', 'S. aureus', 'P. aerugi', 'Enterococ'],
                    datasets: [{
                        label: 'Current Resistance Rate (%)', data: [58, 78, 12, 65, 22],
                        backgroundColor: [CHART_COLORS.redLight, CHART_COLORS.redLight, CHART_COLORS.greenLight, CHART_COLORS.redLight, CHART_COLORS.orangeLight],
                        borderColor: [CHART_COLORS.red, CHART_COLORS.red, CHART_COLORS.green, CHART_COLORS.red, CHART_COLORS.orange], borderWidth: 1.5, borderRadius: 4
                    }]
                },
                options: commonBarOptions
            });

            new Chart(document.getElementById('amrPatternTrendChart'), {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
                    datasets: [
                        { label: 'ESBL Rate (%)', data: [28,29,30,32,31,33,34,35,33,32,34,35], borderColor: CHART_COLORS.purple, backgroundColor: CHART_COLORS.purpleLight, tension:0.4, fill:true, pointRadius:3, pointHoverRadius:5, borderWidth: 1.5 },
                        { label: 'CRE Rate (%)', data: [5,6,7,6,8,9,10,9,11,10,12,11], borderColor: CHART_COLORS.teal, backgroundColor: CHART_COLORS.tealLight, tension:0.4, fill:true, pointRadius:3, pointHoverRadius:5, borderWidth: 1.5 }
                    ]
                },
                options: commonChartOptions
            });
            
            const pathogenResistanceChart = new Chart(document.getElementById('pathogenResistanceChart'), {
                type: 'bar',
                data: {
                    labels: ['Cipro', 'Mero', 'Vanco', 'Ceftriax', 'Pip-Tazo'],
                    datasets: [{
                        label: 'Resistance Rate (%) for E. coli', data: [62, 8, 95, 40, 35], // Initial for E.coli
                        backgroundColor: [CHART_COLORS.redLight, CHART_COLORS.greenLight, CHART_COLORS.redLight, CHART_COLORS.orangeLight, CHART_COLORS.tealLight],
                        borderColor: [CHART_COLORS.red, CHART_COLORS.green, CHART_COLORS.red, CHART_COLORS.orange, CHART_COLORS.teal], borderWidth: 1.5, borderRadius: 4
                    }]
                },
                options: commonBarOptions
            });

            const pathogenTrendChart = new Chart(document.getElementById('pathogenTrendChart'), {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
                    datasets: [{ label: 'E. coli - Ciprofloxacin Trend (%)', data: [52,54,56,55,57,58,59,60,59,58,57,58], borderColor: CHART_COLORS.red, backgroundColor: CHART_COLORS.redLight, tension:0.4, fill:true, pointRadius:3, pointHoverRadius:5, borderWidth: 1.5 }]
                },
                options: commonChartOptions
            });

            new Chart(document.getElementById('wardResistanceChart'), {
                type: 'bar',
                data: {
                    labels: ['ICU', 'Medical', 'Surgical', 'Pediatrics', 'Oncology'],
                    datasets: [{
                        label: 'Average Resistance Rate (%)', data: [48, 32, 28, 25, 41],
                        backgroundColor: [CHART_COLORS.redLight, CHART_COLORS.orangeLight, CHART_COLORS.greenLight, CHART_COLORS.greenLight, CHART_COLORS.redLight],
                        borderColor: [CHART_COLORS.red, CHART_COLORS.orange, CHART_COLORS.green, CHART_COLORS.green, CHART_COLORS.red], borderWidth:1.5, borderRadius: 4
                    }]
                },
                 options: { responsive:true, maintainAspectRatio:false, plugins:{title:{display:false}, legend:{display:false}}, scales:{y:{beginAtZero:true, max:100, grid:{drawBorder:false}}, x:{grid:{display:false}}}}
            });

            new Chart(document.getElementById('wardDistributionChart'), {
                type: 'doughnut',
                data: {
                    labels: ['ICU', 'Medical', 'Surgical', 'Pediatrics', 'Oncology'],
                    datasets: [{
                        label: 'Total Tests', data: [1245, 987, 856, 723, 476],
                        backgroundColor: [CHART_COLORS.primary, CHART_COLORS.teal, CHART_COLORS.green, CHART_COLORS.orange, CHART_COLORS.red], hoverOffset: 8, borderWidth: 2, borderColor: CHART_COLORS.white
                    }]
                },
                options: { responsive:true, maintainAspectRatio:false, cutout: '60%', plugins:{title:{display:false}, legend:{position:'right', labels: {padding: 10, usePointStyle: true, pointStyle: 'circle'}}}}
            });

            new Chart(document.getElementById('interventionChart'), {
                type: 'line',
                data: {
                    labels: ['Q4 22','Q1 23','Q2 23','Q3 23','Q4 23','Q1 24'],
                    datasets: [
                        { label: 'K. pneumo - Mero Resist (%)', data: [70,72,75,68,65,62], borderColor: CHART_COLORS.green, backgroundColor: CHART_COLORS.greenLight, tension:0.4, fill:true, pointRadius:4, pointHoverRadius:6, borderWidth: 1.5 },
                        { label: 'Intervention Point', data: [null,null,{x:'Q2 23',y:75},null,null,null], borderColor: CHART_COLORS.red, backgroundColor: CHART_COLORS.red, pointRadius:8, pointHoverRadius:10, showLine:false, type:'scatter' }
                    ]
                },
                options: { responsive:true, maintainAspectRatio:false, plugins:{title:{display:false}, legend:{position:'bottom'}, tooltip:{callbacks:{label:function(c){return c.dataset.label==='Intervention Point'?'Intervention: '+c.parsed.y+'%':c.dataset.label.split(' - ')[0]+': '+c.parsed.y+'%';}}}}, scales:{y:{beginAtZero:false, grid:{drawBorder:false}}, x:{grid:{display:false}}}}
            });

            document.getElementById('applyFilters').addEventListener('click', function() {
                // Simulate filter application
                alert('Filters applied (simulation). Charts and data would update based on selection.');
                document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit'});
                
                // Hide sidebar on mobile after applying
                const sidebarOffcanvasElement = document.getElementById('sidebar');
                if (sidebarOffcanvasElement) {
                    const sidebarOffcanvas = bootstrap.Offcanvas.getInstance(sidebarOffcanvasElement);
                    if (sidebarOffcanvas && sidebarOffcanvas._isShown) {
                        sidebarOffcanvas.hide();
                    }
                }
            });

            document.getElementById('pathogenSelect').addEventListener('change', function(event) {
                const selectedPathogen = event.target.value;
                document.getElementById('selectedPathogenName').textContent = selectedPathogen;
                
                let newPData, newPTrendData, newPTrendLabel, pDesc, highestR, lowestR, commonW;
                // Antibiotic labels for pathogenResistanceChart: ['Cipro', 'Mero', 'Vanco', 'Ceftriax', 'Pip-Tazo']
                if (selectedPathogen === 'K. pneumoniae') {
                    newPData = [30, 78, 98, 60, 70]; // Cipro, Mero, Vanco(High R for G-), Ceftriax, Pip-Tazo
                    newPTrendData = [65,67,70,72,73,75,76,77,78,77,76,78]; 
                    newPTrendLabel = 'K. pneumo - Mero Trend';
                    pDesc = "Gram-negative, encapsulated bacterium. Often causes HAIs including pneumonia and bloodstream infections."; 
                    highestR = "Meropenem (78%)"; 
                    lowestR = "Ciprofloxacin (30%)"; 
                    commonW = "ICU (55%)";
                } else if (selectedPathogen === 'S. aureus') {
                    newPData = [5, 10, 12, 90, 15]; // Cipro, Mero(Not typical), Vanco, Ceftriax(MRSA often R), Pip-Tazo
                    newPTrendData = [18,17,16,15,14,13,12,13,12,12,11,12]; 
                    newPTrendLabel = 'S. aureus - Vanco Trend';
                    pDesc = "Gram-positive coccus. Common cause of skin/soft tissue infections, bacteremia, and HAIs like MRSA."; 
                    highestR = "Ceftriaxone (90%)"; // Assuming mostly MRSA for high Ceftriaxone R
                    lowestR = "Ciprofloxacin (5%)"; 
                    commonW = "Surgical (38%)";
                } else if (selectedPathogen === 'P. aeruginosa') {
                    newPData = [45, 35, 100, 55, 65]; // Cipro, Mero, Vanco(intrinsic R), Ceftazidime(use Ceftaz), Pip-Tazo
                    newPTrendData = [50,52,55,58,60,62,65,63,60,65,66,65]; 
                    newPTrendLabel = 'P. aeru - Pip-Tazo Trend';
                    pDesc = "Gram-negative rod known for its intrinsic resistance and ability to cause severe HAIs, especially in immunocompromised patients.";
                    highestR = "Pip-Tazo (65%)"; // Example
                    lowestR = "Meropenem (35%)"; // Example
                    commonW = "Oncology (45%)";
                } else if (selectedPathogen === 'Enterococcus spp.') {
                    newPData = [70, 85, 22, 95, 90]; // Cipro, Mero(not typical), Vanco(VRE), Ceftriax(intrinsic R), Pip-Tazo
                    newPTrendData = [15,16,18,20,19,22,21,23,22,20,21,22];
                    newPTrendLabel = 'Entero - Vanco Trend';
                    pDesc = "Gram-positive cocci, part of normal gut flora but can cause HAIs, notable for VRE strains.";
                    highestR = "Ciprofloxacin (70%)";
                    lowestR = "Vancomycin (22%)"; // VRE rate
                    commonW = "Medical (30%)";
                }
                else { // Default to E. coli
                    newPData = [62, 8, 95, 40, 35]; // Cipro, Mero, Vanco(intrinsic R), Ceftriax, Pip-Tazo
                    newPTrendData = [52,54,56,55,57,58,59,60,59,58,57,58]; 
                    newPTrendLabel = 'E. coli - Cipro Trend';
                    pDesc = "Gram-negative bacterium commonly found in the lower intestine. Leading cause of UTIs and other infections."; 
                    highestR = "Ciprofloxacin (62%)"; 
                    lowestR = "Meropenem (8%)"; 
                    commonW = "Medical (42%)";
                }
                pathogenResistanceChart.data.datasets[0].data = newPData; 
                pathogenResistanceChart.data.datasets[0].label = `Resistance Rate (%) for ${selectedPathogen}`; 
                pathogenResistanceChart.update();
                
                pathogenTrendChart.data.datasets[0].data = newPTrendData; 
                pathogenTrendChart.data.datasets[0].label = newPTrendLabel + ' (%)'; 
                pathogenTrendChart.update();

                document.getElementById('pathogenDescription').textContent = pDesc; 
                document.getElementById('highestResistance').textContent = highestR; 
                document.getElementById('lowestResistance').textContent = lowestR; 
                document.getElementById('commonWard').textContent = commonW;
            });
        });
    </script>
</body>
</html>